// App.jsx
import React, { useState } from "react";

const colors = {
  primary: "#1abc9c", // doux et impactant (vert turquoise)
  secondary: "#f39c12", // orange doux
  background: "#f7f9fa", // très clair
  textPrimary: "#333",
  textSecondary: "#555",
  buttonBg: "#d1f0e0",
  buttonHover: "#16a085",
};

const cardsLeft = [
  { id: 1, text: "1) Un nombre est divisible par 2" },
  { id: 2, text: "2) Un nombre entier est divisible par 3" },
  { id: 3, text: "3) Un nombre entier est divisible par 4" },
  { id: 4, text: "4) Un nombre entier est divisible par 5" },
  { id: 5, text: "5) Un nombre entier est divisible par 9" },
  { id: 6, text: "6) Un nombre entier est divisible par 10" },
];

const cardsRight = [
  { id: "A", text: "A) Si son chiffre des unités est pair (0, 2, 4, 6 ou 8)" },
  { id: "B", text: "B) Si la somme de ses chiffres est divisible par 3" },
  { id: "C", text: "C) Si le nombre formé par son chiffre des dizaines et son chiffre des unités est divisible par 4" },
  { id: "D", text: "D) Si son chiffre des unités est 0 ou 5" },
  { id: "E", text: "E) Si la somme de ses chiffres est divisible par 9" },
  { id: "F", text: "F) Si son chiffre des unités est 0" },
];

const correctPairs = {
  1: "A",
  2: "B",
  3: "C",
  4: "D",
  5: "E",
  6: "F",
};

const quizQuestions = [
  {
    id: 1,
    question: "Un nombre est divisible par 2",
    options: [
      "si son chiffre des unités est pair (0, 2, 4, 6 ou 8)",
      "si son chiffre des unités est impair (1, 3, 5, 7, 9)",
    ],
    correctIndex: 0,
  },
  {
    id: 2,
    question: "Un nombre entier est divisible par 3",
    options: [
      "si la somme de ses chiffres est divisible par 3",
      "si la somme de ses chiffres est divisible par 6",
    ],
    correctIndex: 0,
  },
  {
    id: 3,
    question: "Un nombre entier est divisible par 4",
    options: [
      "si le nombre formé par son chiffre des dizaines et son chiffre des unités est divisible par 4",
      "si la somme de ses chiffre est divisible par 4",
    ],
    correctIndex: 0,
  },
  {
    id: 4,
    question: "Un nombre entier est divisible par 5",
    options: [
      "si son chiffre des unités est 0 ou 5",
      "si son chiffre des dizaines est 0 ou 5",
    ],
    correctIndex: 0,
  },
  {
    id: 5,
    question: "Un nombre entier est divisible par 9",
    options: [
      "si la somme de ses chiffres est divisible par 9",
      "si le nombre formé par ses deux dernier chiffre est divisible par 9",
    ],
    correctIndex: 0,
  },
  {
    id: 6,
    question: "Un nombre entier est divisible par 10",
    options: [
      "si son chiffre des unités est 0",
      "si son chiffre des dizaine est 0",
    ],
    correctIndex: 0,
  },
];

// Composant bouton customisé
const Button = ({ onClick, children }) => (
  <button
    onClick={onClick}
    style={{
      backgroundColor: colors.buttonBg,
      border: `2px solid ${colors.primary}`,
      color: colors.primary,
      padding: "10px 20px",
      margin: "0 10px",
      fontWeight: "600",
      borderRadius: "6px",
      cursor: "pointer",
      transition: "background-color 0.3s, color 0.3s",
      fontFamily: "'Montserrat', sans-serif",
      textTransform: "capitalize",
    }}
    onMouseOver={(e) => {
      e.currentTarget.style.backgroundColor = colors.primary;
      e.currentTarget.style.color = "white";
    }}
    onMouseOut={(e) => {
      e.currentTarget.style.backgroundColor = colors.buttonBg;
      e.currentTarget.style.color = colors.primary;
    }}
  >
    {children}
  </button>
);

// Main Page
function Home({ goTo }) {
  return (
    <div style={{ padding: 40, textAlign: "center" }}>
      <h1
        style={{
          fontFamily: "'Montserrat', sans-serif",
          fontWeight: "700",
          fontSize: 48,
          color: colors.primary,
          textTransform: "capitalize",
          marginBottom: 20,
        }}
      >
        Activités ludiques en maths
      </h1>
      <p
        style={{
          fontFamily: "'Georgia', serif",
          fontSize: 18,
          color: colors.textSecondary,
          maxWidth: 600,
          margin: "0 auto 40px",
        }}
      >
        Explore des activités pour comprendre les règles de divisibilité avec des
        jeux interactifs.
      </p>
      <div>
        <Button onClick={() => goTo("activity1")}>Assembler des cartes</Button>
        <Button onClick={() => goTo("activity2")}>Quizz</Button>
      </div>
    </div>
  );
}

// Activity 1: drag and drop assembler cartes
function Activity1({ goTo }) {
  const [draggedId, setDraggedId] = useState(null);
  const [matches, setMatches] = useState({}); // { leftId: rightId }

  function handleDragStart(e, id) {
    setDraggedId(id);
  }

  function handleDrop(e, rightId) {
    e.preventDefault();
    if (draggedId == null) return;
    setMatches((prev) => ({
      ...prev,
      [draggedId]: rightId,
    }));
    setDraggedId(null);
  }

  function handleDragOver(e) {
    e.preventDefault();
  }

  return (
    <div style={{ padding: 20, maxWidth: 900, margin: "auto" }}>
      <h2
        style={{
          fontFamily: "'Montserrat', sans-serif",
          fontWeight: "700",
          fontSize: 36,
          color: colors.primary,
          textTransform: "capitalize",
          marginBottom: 20,
          textAlign: "center",
        }}
      >
        Assembler des cartes
      </h2>

      <div
        style={{
          display: "flex",
          justifyContent: "space-between",
          gap: 20,
          flexWrap: "wrap",
        }}
      >
        {/* Cartes gauche - draggable */}
        <div style={{ flex: 1 }}>
          <h3
            style={{
              fontFamily: "'Montserrat', sans-serif",
              fontWeight: "600",
              fontSize: 20,
              marginBottom: 10,
            }}
          >
            Cartes Nombres
          </h3>
          {cardsLeft.map(({ id, text }) => (
            <div
              key={id}
              draggable
              onDragStart={(e) => handleDragStart(e, id)}
              style={{
                backgroundColor: "#fff",
                border: "2px solid #ddd",
                padding: 12,
                marginBottom: 10,
                borderRadius: 8,
                cursor: "grab",
                boxShadow: "0 1px 3px rgb(0 0 0 / 0.1)",
                fontFamily: "'Georgia', serif",
                userSelect: "none",
              }}
            >
              {text}
            </div>
          ))}
        </div>

        {/* Cartes droite - dropzones */}
        <div style={{ flex: 1 }}>
          <h3
            style={{
              fontFamily: "'Montserrat', sans-serif",
              fontWeight: "600",
              fontSize: 20,
              marginBottom: 10,
            }}
          >
            Cartes Définitions
          </h3>
          {cardsRight.map(({ id, text }) => {
            // Check if this right card is matched to any left card
            const matchedLeft = Object.entries(matches).find(
              ([left, right]) => right === id
            );

            // Style for matched pairs (green border)
            const matched =
              matchedLeft &&
              correctPairs[matchedLeft[0]] === id;

            return (
              <div
                key={id}
                onDrop={(e) => handleDrop(e, id)}
                onDragOver={handleDragOver}
                style={{
                  backgroundColor: matched ? "#d4edda" : "#fff",
                  border: matched
                    ? `2px solid ${colors.primary}`
                    : "2px dashed #ccc",
                  padding: 12,
                  marginBottom: 10,
                  borderRadius: 8,
                  minHeight: 48,
                  fontFamily: "'Georgia', serif",
                  color: matched ? colors.primary : colors.textSecondary,
                }}
              >
                {text}
                {matched && (
                  <span
                    style={{
                      marginLeft: 10,
                      fontWeight: "bold",
                      color: colors.primary,
                    }}
                  >
                    ✓
                  </span>
                )}
              </div>
            );
          })}
        </div>
      </div>

      <div style={{ textAlign: "center", marginTop: 30 }}>
        <Button onClick={() => goTo("home")}>Retour accueil</Button>
      </div>
    </div>
  );
}

// Activity 2: quiz
function Activity2({ goTo }) {
  const [answers, setAnswers] = useState({});
  const [showResult, setShowResult] = useState(false);

  function selectAnswer(qId, index) {
    if (showResult) return; // Bloquer modif après résultat
    setAnswers((prev) => ({
      ...prev,
      [qId]: index,
    }));
  }

  function checkResults() {
    setShowResult(true);
  }

  const score = quizQuestions.reduce((acc, q) => {
    if (answers[q.id] === q.correctIndex) return acc + 1;
    return acc;
  }, 0);

  return (
    <div style={{ padding: 20, maxWidth: 700, margin: "auto" }}>
      <h2
        style={{
          fontFamily: "'Montserrat', sans-serif",
          fontWeight: "700",
          fontSize: 36,
          color: colors.primary,
          textTransform: "capitalize",
          marginBottom: 20,
          textAlign: "center",
        }}
      >
        Quizz divisibilité
      </h2>

      {quizQuestions.map(({ id, question, options, correctIndex }) => (
        <div
          key={id}
          style={{
            marginBottom: 25,
            fontFamily: "'Georgia', serif",
          }}
        >
          <h3
            style={{
              fontFamily: "'Montserrat', sans-serif",
              fontWeight: "600",
              fontSize: 20,
              marginBottom: 8,
              textTransform: "capitalize",
            }}
          >
            Question {id}: {question}
          </h3>

          {options.map((opt, i) => {
            const selected = answers[id] === i;
            const isCorrect = showResult && i === correctIndex;
            const isWrong = showResult && selected && i !== correctIndex;

            return (
              <div
                key={i}
                onClick={() => selectAnswer(id, i)}
                style={{
                  cursor: showResult ? "default" : "pointer",
                  backgroundColor: selected
                    ? isCorrect
                      ? "#d4edda"
                      : isWrong
                      ? "#f8d7da"
                      : "#cce5ff"
                    : "#f9f9f9",
                  border: `2px solid ${
                    isCorrect
                      ? colors.primary
                      : selected
                      ? "#dc3545"
                      : "#ccc"
                  }`,
                  borderRadius: 6,
                  padding: 10,
                  marginBottom: 6,
                  userSelect: "none",
                  color: "#333",
                }}
              >
                {String.fromCharCode(97 + i)}) {opt}
              </div>
            );
          })}
        </div>
      ))}

      <div style={{ textAlign: "center", marginTop: 20 }}>
        {!showResult && (
          <Button
            onClick={checkResults}
            disabled={Object.keys(answers).length !== quizQuestions.length}
            style={{ opacity: Object.keys(answers).length === quizQuestions.length ? 1 : 0.5 }}
          >
            Vérifier mes réponses
          </Button>
        )}
        {showResult && (
          <>
            <p
              style={{
                fontSize: 22,
                fontWeight: "700",
                color: colors.primary,
              }}
            >
              Votre score: {score} / {quizQuestions.length}
            </p>
            <Button onClick={() => {
              setAnswers({});
              setShowResult(false);
            }}>
              Recommencer
            </Button>
          </>
        )}
        <div style={{ marginTop: 20 }}>
          <Button onClick={() => goTo("home")}>Retour accueil</Button>
        </div>
      </div>
    </div>
  );
}

export default function App() {
  const [page, setPage] = useState("home");

  return (
    <div
      style={{
        backgroundColor: colors.background,
        minHeight: "100vh",
        color: colors.textPrimary,
        fontSize: 16,
        padding: 20,
      }}
    >
      {page === "home" && <Home goTo={setPage} />}
      {page === "activity1" && <Activity1 goTo={setPage} />}
      {page === "activity2" && <Activity2 goTo={setPage} />}
    </div>
  );
}
