<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Homothetie - Quiz</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f9f9f9;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      text-align: center;
      margin: 10px;
      color: #3a86ff;
    }
    #quiz-container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      width: 90vw;
    }
    #grid {
      flex: 1;
      aspect-ratio: 16 / 9;
      background:white;
      border:2px solid #ccc;
      border-radius:12px;
      margin: 10px;
      position: relative;
    }
    svg { width:100%; height:100%; display:block }
    .question {
      position: absolute;
      top: 10px;
      width: 100%;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      color: #333;
    }
    .feedback {
      text-align: center;
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Homothetie</h1>

  <div id="quiz-container">
    <div id="grid">
      <div class="question" id="questionText"></div>
      <svg id="svgGrid" viewBox="0 0 960 540" preserveAspectRatio="xMidYMid meet"></svg>
    </div>
  </div>

  <div id="feedback" class="feedback"></div>

<script>
const svg = document.getElementById('svgGrid');
const width = 960, height = 540;
const cols = 30, rows = 40;
const cellW = width / cols, cellH = height / rows;

function drawGrid(){
  for(let i=0;i<=cols;i++){
    let l = document.createElementNS("http://www.w3.org/2000/svg","line");
    l.setAttribute("x1", i*cellW);
    l.setAttribute("y1", 0);
    l.setAttribute("x2", i*cellW);
    l.setAttribute("y2", height);
    l.setAttribute("stroke", "#eee");
    svg.appendChild(l);
  }
  for(let j=0;j<=rows;j++){
    let l = document.createElementNS("http://www.w3.org/2000/svg","line");
    l.setAttribute("x1", 0);
    l.setAttribute("y1", j*cellH);
    l.setAttribute("x2", width);
    l.setAttribute("y2", j*cellH);
    l.setAttribute("stroke", "#eee");
    svg.appendChild(l);
  }
}
drawGrid();

// --- génération d'une question ---
let points = [];
let scale = 2;
let O = {x: Math.floor(Math.random()*cols/2)*cellW, y: Math.floor(Math.random()*rows/2)*cellH};

function generateRectangle(){
  points = [
    {x:5*cellW, y:10*cellH},
    {x:15*cellW, y:10*cellH},
    {x:15*cellW, y:20*cellH},
    {x:5*cellW, y:20*cellH}
  ];
  drawFigure(points,"blue",0.3);
  document.getElementById("questionText").textContent = `Place l'image du rectangle par l'homothétie de centre O et de rapport ${scale}`;
  drawPoint(O,"black","O");
}
function homothety(P){
  return {
    x: O.x + scale*(P.x - O.x),
    y: O.y + scale*(P.y - O.y)
  };
}
function drawFigure(pts,color,opacity){
  let poly = document.createElementNS("http://www.w3.org/2000/svg","polygon");
  poly.setAttribute("points", pts.map(p=>`${p.x},${p.y}`).join(" "));
  poly.setAttribute("fill", color);
  poly.setAttribute("opacity", opacity);
  svg.appendChild(poly);
}
function drawPoint(P,color,label){
  let c = document.createElementNS("http://www.w3.org/2000/svg","circle");
  c.setAttribute("cx",P.x); c.setAttribute("cy",P.y); c.setAttribute("r",5);
  c.setAttribute("fill",color);
  svg.appendChild(c);
}

generateRectangle();

let studentPts = [];
svg.addEventListener("click", e=>{
  let rect = svg.getBoundingClientRect();
  let x = (e.clientX-rect.left)/rect.width*width;
  let y = (e.clientY-rect.top)/rect.height*height;
  studentPts.push({x,y});
  drawPoint({x,y},"purple");

  if(studentPts.length===points.length){
    // dessiner la figure élève
    drawFigure(studentPts,"purple",0.4);

    // calculer la bonne réponse
    let correctPts = points.map(p=>homothety(p));
    drawFigure(correctPts,"green",0.2);

    // comparer
    let ok = studentPts.every((p,i)=>{
      let q = correctPts[i];
      return Math.abs(p.x-q.x)<cellW/2 && Math.abs(p.y-q.y)<cellH/2;
    });

    let feedback = document.getElementById("feedback");
    if(ok){
      feedback.style.color="green";
      feedback.textContent="✅ Bonne réponse !";
    } else {
      feedback.style.color="red";
      feedback.textContent="❌ Mauvaise réponse. La figure correcte est affichée en vert.";
    }
  }
});
</script>
</body>
</html>
