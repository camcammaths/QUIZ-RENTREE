<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Homothétie</title>

  <!-- Polices -->
  <link href="https://fonts.googleapis.com/css2?family=Androgy+Demo&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Mabry+Pro&display=swap" rel="stylesheet" />

  <style>
    :root {
      --primary-color: #5b6dfa;
      --accent-color: #8000ff;
      --good-color: rgba(0, 200, 0, 0.4);
      --bad-color: rgba(200, 0, 0, 0.4);
      --start-color: rgba(128, 0, 255, 0.25);
      --background-color: #f9f9f9;
      --grid-color: #e0e0e0;
      --text-color: #222;
    }

    body {
      margin: 0;
      font-family: 'Mabry Pro', sans-serif;
      background: var(--background-color);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    header {
      font-family: 'Androgy Demo', sans-serif;
      font-size: 2.5rem;
      text-align: center;
      padding: 1rem;
      color: var(--primary-color);
      border-bottom: 2px solid var(--grid-color);
    }

    .layout {
      display: flex;
      flex: 1;
    }

    aside {
      width: 25%;
      padding: 1rem;
      background: white;
      border-right: 2px solid var(--grid-color);
      overflow-y: auto;
    }

    aside h2 {
      font-size: 1.2rem;
      margin: 0 0 1rem;
      color: var(--primary-color);
    }

    aside ul {
      padding-left: 1rem;
      list-style: none;
    }

    aside li {
      margin-bottom: 0.6rem;
      cursor: pointer;
    }

    aside li.active {
      font-weight: bold;
      color: var(--accent-color);
    }

    main {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #fff;
    }

    #grid {
      width: 90%;
      max-width: 960px;
      aspect-ratio: 16/9;
      border: 2px solid var(--grid-color);
      background: #fff;
    }

    svg {
      width: 100%;
      height: 100%;
    }

    .status {
      width: 15%;
      padding: 1rem;
      border-left: 2px solid var(--grid-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.2rem;
      color: var(--primary-color);
    }
  </style>
</head>
<body>

  <header>Homothétie</header>

  <div class="layout">
    <aside>
      <h2>Questions</h2>
      <ul id="qList"></ul>
    </aside>

    <main>
      <div id="grid"><svg id="svgGrid" viewBox="0 0 1280 720"></svg></div>
    </main>

    <div class="status" id="status">1 / 10</div>
  </div>

  <script>
    const svg = document.getElementById("svgGrid");
    const ns = "http://www.w3.org/2000/svg";
    const width = 1280, height = 720, gridSize = 40;
    function el(tag, attrs = {}) {
      const e = document.createElementNS(ns, tag);
      for (const k in attrs) e.setAttribute(k, attrs[k]);
      return e;
    }
    function clear() { while (svg.firstChild) svg.removeChild(svg.firstChild); }
    function grid() {
      for (let i = 0; i <= width; i += gridSize)
        svg.appendChild(el("line", {x1:i, y1:0, x2:i, y2:height, stroke:"#eee"}));
      for (let j = 0; j <= height; j += gridSize)
        svg.appendChild(el("line", {x1:0, y1:j, x2:width, y2:j, stroke:"#eee"}));
    }
    function snap(x, y) {
      return {x: Math.round(x / gridSize) * gridSize, y: Math.round(y / gridSize) * gridSize};
    }
    function drawPoly(pts, color, stroke=color) {
      svg.appendChild(el("polygon", {points:pts.map(p=>`${p.x},${p.y}`).join(" "), fill:color, stroke:stroke, "stroke-width":2}));
    }
    function drawPoint(p, c="#000") {
      svg.appendChild(el("circle", {cx:p.x, cy:p.y, r:6, fill:c, stroke:"#000"}));
    }
    function homothetie(O, P, k) {
      return snap(O.x + k * (P.x - O.x), O.y + k * (P.y - O.y));
    }

    const questions = [
      {label:"Homothétie rapport 2", O:{x:200,y:160}, pts:[{x:160,y:120},{x:280,y:120},{x:280,y:200},{x:160,y:200}], k:2},
      {label:"Homothétie rapport 1/2", O:{x:1000,y:400}, pts:[{x:960,y:360},{x:1040,y:360},{x:1000,y:440}], k:0.5},
      {label:"Homothétie rapport 3", O:{x:400,y:500}, pts:[{x:360,y:460},{x:440,y:460},{x:440,y:540},{x:360,y:540}], k:3},
      {label:"Homothétie rapport 1/3", O:{x:800,y:200}, pts:[{x:760,y:160},{x:840,y:160},{x:800,y:240}], k:1/3}
    ];
    let current = 0, userPts = [], expected = [];

    const qList = document.getElementById("qList");
    questions.forEach((q,i)=>{
      const li=document.createElement("li");
      li.textContent=(i+1)+". "+q.label;
      li.onclick=()=>render(i);
      qList.appendChild(li);
    });

    function render(idx) {
      current=idx; userPts=[]; clear(); grid();
      [...qList.children].forEach((li,i)=>li.classList.toggle("active",i===idx));
      const q=questions[idx];
      drawPoly(q.pts,"var(--start-color)"); 
      q.pts.forEach(p=>drawPoint(p,"var(--primary-color)"));
      drawPoint(q.O,"#000");
      expected=q.pts.map(p=>homothetie(q.O,p,q.k));
      document.getElementById("status").textContent=`${idx+1} / ${questions.length}`;
    }

    function isCorrect(a,b){
      if(a.length!==b.length) return false;
      for(let i=0;i<a.length;i++)
        if(Math.abs(a[i].x-b[i].x)>1 || Math.abs(a[i].y-b[i].y)>1) return false;
      return true;
    }

    svg.addEventListener("click", e=>{
      const rect=svg.getBoundingClientRect();
      const x=(e.clientX-rect.left)*(width/rect.width);
      const y=(e.clientY-rect.top)*(height/rect.height);
      const p=snap(x,y);
      userPts.push(p); drawPoint(p,"var(--accent-color)");
      if(userPts.length===expected.length){
        if(isCorrect(userPts,expected)){
          drawPoly(userPts,"var(--good-color)");
        }else{
          drawPoly(userPts,"var(--bad-color)");
          drawPoly(expected,"var(--good-color)","#008000");
        }
      }
    });

    render(0);
  </script>
</body>
</html>
