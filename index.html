<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Homothétie – Géométrie</title>
  <link href="https://fonts.googleapis.com/css2?family=Androgy+Demo&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Mabry+Pro&display=swap" rel="stylesheet" />
  <style>
    :root {
      --primary-color: #5b6dfa;
      --secondary-color: #00bfa6;
      --accent-color: #ff6b6b;
      --background-color: #f9f9f9;
      --grid-color: #dcdcdc;
      --text-color: #222;
    }
    body {
      font-family: 'Mabry Pro', sans-serif;
      background: var(--background-color);
      text-align: center;
      padding: 2rem;
    }
    h1 {
      font-family: 'Androgy Demo', sans-serif;
      color: var(--primary-color);
    }
    #grid {
      margin: 2rem auto;
      background: white;
      border: 2px solid var(--grid-color);
      width: 600px; height: 600px;
    }
    svg { width: 100%; height: 100%; }
    .pointO { fill: black; }
    .pointInit { fill: var(--primary-color); }
    .pointUser { fill: var(--accent-color); cursor: pointer; }
    .btn { padding: 0.7rem 1.4rem; margin-top: 1rem;
      background: var(--primary-color); color:white; border:none; border-radius:8px; cursor:pointer; }
  </style>
</head>
<body>

<h1>Homothétie</h1>
<p>Construis l’image du rectangle ABCD par l’homothétie de centre O et de rapport 2.<br>
Clique pour placer les 4 points A′, B′, C′, D′.</p>

<div id="grid">
  <svg id="svgGrid"></svg>
</div>
<button class="btn" onclick="checkAnswer()">Vérifier</button>

<script>
const svg = document.getElementById('svgGrid');
const gridSize = 20, cols=30, rows=30;

//--- Dessin de la grille
for(let i=0;i<=cols;i++){
  let l=document.createElementNS("http://www.w3.org/2000/svg","line");
  l.setAttribute("x1",i*gridSize); l.setAttribute("y1",0);
  l.setAttribute("x2",i*gridSize); l.setAttribute("y2",rows*gridSize);
  l.setAttribute("stroke","#eee"); svg.appendChild(l);
}
for(let j=0;j<=rows;j++){
  let l=document.createElementNS("http://www.w3.org/2000/svg","line");
  l.setAttribute("x1",0); l.setAttribute("y1",j*gridSize);
  l.setAttribute("x2",cols*gridSize); l.setAttribute("y2",j*gridSize);
  l.setAttribute("stroke","#eee"); svg.appendChild(l);
}

//--- Centre O
const O={x:300,y:300};
let o=document.createElementNS("http://www.w3.org/2000/svg","circle");
o.setAttribute("cx",O.x); o.setAttribute("cy",O.y); o.setAttribute("r",6); o.setAttribute("class","pointO");
svg.appendChild(o);
let ot=document.createElementNS("http://www.w3.org/2000/svg","text");
ot.setAttribute("x",O.x+8); ot.setAttribute("y",O.y-8); ot.textContent="O"; svg.appendChild(ot);

//--- Rectangle initial ABCD
const A={x:200,y:200}, B={x:260,y:200}, C={x:260,y:240}, D={x:200,y:240};
drawPoint(A,"A"); drawPoint(B,"B"); drawPoint(C,"C"); drawPoint(D,"D");
drawPolygon([A,B,C,D],"#5b6dfa");

//--- Fonction utilitaire
function drawPoint(p,label,cls="pointInit"){
  let c=document.createElementNS("http://www.w3.org/2000/svg","circle");
  c.setAttribute("cx",p.x); c.setAttribute("cy",p.y); c.setAttribute("r",5);
  c.setAttribute("class",cls); svg.appendChild(c);
  let t=document.createElementNS("http://www.w3.org/2000/svg","text");
  t.setAttribute("x",p.x+6); t.setAttribute("y",p.y-6); t.textContent=label; svg.appendChild(t);
}
function drawPolygon(pts,color){
  let poly=document.createElementNS("http://www.w3.org/2000/svg","polygon");
  poly.setAttribute("points",pts.map(p=>`${p.x},${p.y}`).join(" "));
  poly.setAttribute("fill",color); poly.setAttribute("opacity",0.2);
  poly.setAttribute("stroke",color); poly.setAttribute("stroke-width",2);
  svg.appendChild(poly);
}

//--- Réponses attendues (homothétie k=2)
function homothety(P){
  return {x: O.x + 2*(P.x-O.x), y: O.y + 2*(P.y-O.y)};
}
const A2=homothety(A), B2=homothety(B), C2=homothety(C), D2=homothety(D);

//--- Clics de l’élève
let userPoints=[];
svg.addEventListener("click", e=>{
  if(userPoints.length>=4) return;
  const rect=svg.getBoundingClientRect();
  const x=Math.round((e.clientX-rect.left)/gridSize)*gridSize;
  const y=Math.round((e.clientY-rect.top)/gridSize)*gridSize;
  userPoints.push({x,y});
  drawPoint({x,y},"", "pointUser");
});

//--- Vérification
function checkAnswer(){
  if(userPoints.length<4){alert("Place 4 points d’abord !"); return;}
  let correct=[A2,B2,C2,D2];
  let good=0;
  for(let i=0;i<4;i++){
    let up=userPoints[i];
    // tolérance 5px
    if(correct.some(p=>Math.abs(p.x-up.x)<6 && Math.abs(p.y-up.y)<6)) good++;
  }
  if(good===4){
    drawPolygon(userPoints,"green");
    alert("Bravo ! Ton rectangle est correct ✅");
  }else{
    drawPolygon(userPoints,"red");
    alert("Ce n’est pas correct ❌ Essaie encore.");
  }
}
</script>
</body>
</html>
