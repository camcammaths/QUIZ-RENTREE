<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Homothétie - Quiz</title>

  <!-- Polices -->
  <link href="https://fonts.googleapis.com/css2?family=Androgy+Demo&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Mabry+Pro&display=swap" rel="stylesheet" />

  <style>
    :root {
      --primary: #5b6dfa;
      --secondary: #00bfa6;
      --accent: #ff6b6b;
      --grid: #e0e0e0;
      --figure: rgba(128,0,128,0.3);
      --border-radius: 10px;
    }

    body {
      margin: 0;
      font-family: 'Mabry Pro', sans-serif;
      background: #f9f9f9;
      color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 1rem;
    }

    h1 {
      font-family: 'Androgy Demo', sans-serif;
      font-size: 2.5rem;
      color: var(--primary);
      margin-bottom: 1rem;
    }

    .question-box {
      text-align: center;
      margin-bottom: 1rem;
    }
    #question {
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
    }
    #progress {
      font-weight: bold;
      color: var(--secondary);
    }

    #grid {
      width: 800px;
      height: 450px; /* format 16/9 */
      background: white;
      border: 2px solid var(--grid);
      border-radius: var(--border-radius);
      margin: 1rem 0;
    }
    svg { width: 100%; height: 100%; }

    .btn {
      padding: 0.7rem 1.2rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: 0.3s;
      font-size: 1rem;
    }
    .btn:hover { background: var(--secondary); }

    .feedback {
      font-weight: bold;
      margin: 0.5rem;
    }
  </style>
</head>
<body>

  <h1>Homothétie</h1>

  <div class="question-box">
    <div id="question">Question</div>
    <div id="progress">1 / 10</div>
  </div>

  <div id="grid"><svg id="svgGrid"></svg></div>

  <div id="feedback" class="feedback"></div>
  <button class="btn" onclick="nextQuestion()">Question suivante</button>

  <script>
    const svg = document.getElementById("svgGrid");
    const gridSize = 20, cols = 40, rows = 22;
    let current = 0, userPts = [], expected = [];

    const questions = [
      { text:"Construire l’image du triangle par homothétie de rapport 2", 
        O:{x:200,y:200}, pts:[{x:240,y:260},{x:280,y:200},{x:200,y:160}], k:2 },
      { text:"Construire l’image du triangle par homothétie de rapport 1/2", 
        O:{x:400,y:100}, pts:[{x:440,y:180},{x:480,y:100},{x:400,y:60}], k:0.5 },
      { text:"Construire l’image du rectangle par homothétie de rapport -1", 
        O:{x:300,y:300}, pts:[{x:320,y:320},{x:400,y:320},{x:400,y:380},{x:320,y:380}], k:-1 },
      { text:"Construire l’image du triangle par homothétie de rapport 3", 
        O:{x:500,y:200}, pts:[{x:540,y:260},{x:580,y:200},{x:500,y:140}], k:3 },
      // ... complète jusqu'à 10
    ];

    function el(tag,attrs={}){const e=document.createElementNS("http://www.w3.org/2000/svg",tag);for(const k in attrs)e.setAttribute(k,attrs[k]);return e;}
    function clear(){while(svg.firstChild)svg.removeChild(svg.firstChild);}
    function drawGrid(){
      for(let i=0;i<=cols;i++) svg.appendChild(el("line",{x1:i*gridSize,y1:0,x2:i*gridSize,y2:rows*gridSize,stroke:"#e0e0e0"}));
      for(let j=0;j<=rows;j++) svg.appendChild(el("line",{x1:0,y1:j*gridSize,x2:cols*gridSize,y2:j*gridSize,stroke:"#e0e0e0"}));
    }
    function drawPoly(pts,color,stroke="purple"){
      svg.appendChild(el("polygon",{points:pts.map(p=>`${p.x},${p.y}`).join(" "),fill:color,stroke:stroke,"stroke-width":2}));
    }
    function drawPoint(p,c){svg.appendChild(el("circle",{cx:p.x,cy:p.y,r:5,fill:c,stroke:"black"}));}
    function snap(x,y){return {x:Math.round(x/gridSize)*gridSize,y:Math.round(y/gridSize)*gridSize};}
    function homothety(O,P,k){return snap(O.x+k*(P.x-O.x),O.y+k*(P.y-O.y));}

    function render(idx){
      clear(); drawGrid();
      userPts = [];
      const q = questions[idx];
      // figure de départ
      drawPoly(q.pts,"rgba(91,109,250,0.25)");
      q.pts.forEach(p=>drawPoint(p,"#5b6dfa"));
      // centre O
      drawPoint(q.O,"#00bfa6");
      expected = q.pts.map(p=>homothety(q.O,p,q.k));
      document.getElementById("question").textContent = q.text;
      document.getElementById("progress").textContent = (idx+1)+" / "+questions.length;
      document.getElementById("feedback").textContent = "";
    }

    // --- Interaction élève ---
    svg.addEventListener("click", e=>{
      if(!questions[current]) return;
      const q = questions[current];
      if(userPts.length >= q.pts.length) return;

      const rect = svg.getBoundingClientRect();
      const x = (e.clientX-rect.left)/rect.width*cols*gridSize;
      const y = (e.clientY-rect.top)/rect.height*rows*gridSize;
      const pt = snap(x,y);
      userPts.push(pt);
      drawPoint(pt,"#ff6b6b");

      // Quand tous les points sont posés
      if(userPts.length === q.pts.length){
        drawPoly(userPts,"rgba(128,0,128,0.3)","purple");

        // Vérification
        let ok = userPts.every((p,i)=>{
          const ex = expected[i];
          return Math.abs(p.x-ex.x)<=gridSize/2 && Math.abs(p.y-ex.y)<=gridSize/2;
        });

        if(ok){
          document.getElementById("feedback").style.color = "green";
          document.getElementById("feedback").textContent = "✅ Bonne réponse !";
        } else {
          document.getElementById("feedback").style.color = "red";
          document.getElementById("feedback").textContent = "❌ Mauvaise réponse. La bonne figure est affichée en vert.";
          drawPoly(expected,"rgba(0,255,0,0.3)","green");
        }
      }
    });

    function nextQuestion(){
      if(current < questions.length-1){ current++; render(current);}
      else alert("Quiz terminé !");
    }

    render(current);
  </script>

</body>
</html>
